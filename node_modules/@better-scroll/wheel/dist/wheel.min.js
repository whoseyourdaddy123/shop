!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Wheel=t()}(this,function(){"use strict";var o="undefined"!=typeof window,e=o&&navigator.userAgent.toLowerCase();e&&/wechatdevtools/.test(e),e&&e.indexOf("android");var i=o&&document.createElement("div").style,t=function(){if(!o)return!1;var e={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var t in e)if(void 0!==i[e[t]])return t;return!1}();function n(e){return!1===t?e:"standard"===t?"transitionEnd"===e?"transitionend":e:t+e.charAt(0).toUpperCase()+e.substr(1)}t&&"standard"!==t&&t.toLowerCase();var s=n("transform"),r=(n("transition"),o&&n("perspective"),s),l=n("transitionTimingFunction"),a=n("transitionDuration");n("transitionDelay"),n("transformOrigin"),n("transitionEnd");function h(e,t){return new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)}var c={style:"cubic-bezier(0.23, 1, 0.32, 1)",fn:function(e){return 1+--e*e*e*e*e}},d=o&&window;function m(){}o&&(d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.oRequestAnimationFrame),o&&(d.cancelAnimationFrame||d.webkitCancelAnimationFrame||d.mozCancelAnimationFrame||d.oCancelAnimationFrame);var f=[{key:"wheelTo",name:"wheelTo"},{key:"getSelectedIndex",name:"getSelectedIndex"}].map(function(e){return{key:e.key,sourceKey:"plugins.wheel."+e.name}}),u=4;function p(e){this.scroll=e,this.options=this.scroll.options.wheel,this.init()}return p.prototype.init=function(){this.options&&(this.normalizeOptions(),this.refresh(),this.tapIntoHooks(),this.wheelTo(this.selectedIndex),this.scroll.proxy(f))},p.prototype.tapIntoHooks=function(){var o=this,e=this.scroll.scroller,t=e.actionsHandler,i=e.scrollBehaviorY,n=e.animater;this.scroll.on(this.scroll.hooks.eventTypes.refresh,function(){o.refresh()}),e.hooks.on(e.hooks.eventTypes.checkClick,function(){var e=Array.from(o.items).indexOf(o.target);return-1===e||o.wheelTo(e,o.options.adjustTime,c),!0}),e.hooks.on(e.hooks.eventTypes.scrollTo,function(e){e.y=o.findNearestValidWheel(e.y).y}),e.hooks.on(e.hooks.eventTypes.scrollToElement,function(e,t){if(!h(e,o.options.wheelItemClass))return!0;t.top=o.findNearestValidWheel(t.top).y}),e.hooks.on(e.hooks.eventTypes.ignoreDisMoveForSamePos,function(){return!0}),t.hooks.on(t.hooks.eventTypes.beforeStart,function(e){o.target=e.target}),i.hooks.on(i.hooks.eventTypes.momentum,function(e,t){e.rate=u,e.destination=o.findNearestValidWheel(e.destination).y,t<1e3&&(e.duration=Math.max(800,t/1e3*o.scroll.options.swipeTime))}),i.hooks.on(i.hooks.eventTypes.end,function(e){var t=o.findNearestValidWheel(i.currentPos);e.destination=t.y,e.duration=o.options.adjustTime,o.selectedIndex=t.index}),n.hooks.on(n.hooks.eventTypes.time,function(e){o.transitionDuration(e)}),n.hooks.on(n.hooks.eventTypes.timeFunction,function(e){o.timeFunction(e)}),n.hooks.on(n.hooks.eventTypes.beforeForceStop,function(e){var t=e.y;return o.target=o.items[o.findNearestValidWheel(t).index],!0}),n.translater.hooks.on(n.translater.hooks.eventTypes.translate,function(e){o.rotateX(e.y),o.selectedIndex=o.findNearestValidWheel(e.y).index})},p.prototype.refresh=function(){var e=this.scroll.scroller,t=e.scrollBehaviorY,o=function(e){if(e instanceof window.SVGElement){var t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}}(e.content);t.contentSize=o.height,this.items=e.content.children,this.checkWheelAllDisabled(),this.itemHeight=this.items.length?t.contentSize/this.items.length:0,void 0===this.selectedIndex&&(this.selectedIndex=this.options.selectedIndex||0),this.scroll.maxScrollX=0,this.scroll.maxScrollY=-this.itemHeight*(this.items.length-1),this.scroll.minScrollX=0,this.scroll.minScrollY=0,t.hasScroll=t.options&&this.scroll.maxScrollY<this.scroll.minScrollY},p.prototype.getSelectedIndex=function(){return this.selectedIndex},p.prototype.wheelTo=function(e,t,o,i){void 0===e&&(e=0),void 0===t&&(t=0);var n=-e*this.itemHeight;this.scroll.scrollTo(0,n,t,o,i)},p.prototype.transitionDuration=function(e){for(var t=0;t<this.items.length;t++)this.items[t].style[a]=e+"ms"},p.prototype.timeFunction=function(e){for(var t=0;t<this.items.length;t++)this.items[t].style[l]=e},p.prototype.rotateX=function(e){for(var t=this.options.rotate,o=void 0===t?25:t,i=0;i<this.items.length;i++){var n=o*(e/this.itemHeight+i);this.items[i].style[r]="rotateX("+n+"deg)"}},p.prototype.findNearestValidWheel=function(e){e=0<e?0:e<this.scroll.maxScrollY?this.scroll.maxScrollY:e;for(var t=Math.abs(Math.round(-e/this.itemHeight)),o=t,i=this.items,n=this.options.wheelDisabledItemClass;0<=t&&h(i[t],n);)t--;if(t<0)for(t=o;t<=i.length-1&&h(i[t],n);)t++;return t===i.length&&(t=o),{index:this.wheelItemsAllDisabled?-1:t,y:-t*this.itemHeight}},p.prototype.normalizeOptions=function(){var e=this.options=function(e){return"object"==typeof e&&null!==e}(this.options)?this.options:{};e.wheelWrapperClass||(e.wheelWrapperClass="wheel-scroll"),e.wheelItemClass||(e.wheelItemClass="wheel-item"),e.rotate||(e.rotate=25),e.adjustTime||(e.adjustTime=400),e.wheelDisabledItemClass||(e.wheelDisabledItemClass="wheel-disabled-item")},p.prototype.checkWheelAllDisabled=function(){var e=this.options.wheelDisabledItemClass,t=this.items;this.wheelItemsAllDisabled=!0;for(var o=0;o<t.length;o++)if(!h(t[o],e)){this.wheelItemsAllDisabled=!1;break}},p.pluginName="wheel",p});
