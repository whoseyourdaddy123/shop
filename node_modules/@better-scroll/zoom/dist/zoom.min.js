!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t=t||self).Zoom=o()}(this,function(){"use strict";var o=[{key:"zoomTo",name:"zoomTo"}].map(function(t){return{key:t.key,sourceKey:"plugins.zoom."+t.name}}),s="undefined"!=typeof window,t=s&&navigator.userAgent.toLowerCase();t&&/wechatdevtools/.test(t),t&&t.indexOf("android");var e=s&&document.createElement("div").style,i=function(){if(!s)return!1;var t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var o in t)if(void 0!==e[t[o]])return o;return!1}();function r(t){return!1===i?t:"standard"===i?"transitionEnd"===t?"transitionend":t:i+t.charAt(0).toUpperCase()+t.substr(1)}function l(t){var o=t.getBoundingClientRect();return{left:-(o.left+window.pageXOffset),top:-(o.top+window.pageYOffset)}}i&&"standard"!==i&&i.toLowerCase(),r("transform"),r("transition"),s&&r("perspective"),r("transitionTimingFunction"),r("transitionDuration"),r("transitionDelay");var n=r("transformOrigin");r("transitionEnd");var a=s&&window;function h(){}s&&(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame),s&&(a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.oCancelAnimationFrame);function c(t){this.scroll=t,this.scale=1,this.scroll.proxy(o),this.scroll.registerType(["zoomStart","zoomEnd"]),this.zoomOpt=this.scroll.options.zoom,this.lastTransformScale=this.scale,this.hooksFn=[],this.init()}return c.prototype.init=function(){var e=this,t=this.scroll.scroller;this.wrapper=this.scroll.scroller.wrapper,this.scaleElement=this.scroll.scroller.content,this.scaleElement.style[n]="0 0",this.scaleElementInitSize=function(t){if(t instanceof window.SVGElement){var o=t.getBoundingClientRect();return{top:o.top,left:o.left,width:o.width,height:o.height}}return{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}(this.scaleElement);var o=t.scrollBehaviorX,s=t.scrollBehaviorY;this.initScrollBoundary={x:[o.minScrollPos,o.maxScrollPos],y:[s.minScrollPos,s.maxScrollPos]},this.registorHooks(t.actions.hooks,"start",function(t){t.touches&&1<t.touches.length&&e.zoomStart(t)}),this.registorHooks(t.actions.hooks,"beforeMove",function(t){return!(!t.touches||t.touches.length<2||(e.zoom(t),0))}),this.registorHooks(t.actions.hooks,"beforeEnd",function(){return!!e.zooming&&(e.zoomEnd(),!0)}),this.registorHooks(t.translater.hooks,"beforeTranslate",function(t,o){var s=o.scale?o.scale:e.lastTransformScale;e.lastTransformScale=s,t.push("scale("+s+")")}),this.registorHooks(t.hooks,"ignoreDisMoveForSamePos",function(){return!0}),this.registorHooks(this.scroll.hooks,"destroy",this.destroy)},c.prototype.zoomTo=function(t,o,s){var e=l(this.wrapper),i=e.left,r=e.top,n=o+i-this.scroll.x,a=s+r-this.scroll.y;this.zooming=!0,this._zoomTo(t,{x:n,y:a},this.scale),this.zooming=!1},c.prototype.zoomStart=function(t){this.zooming=!0;var o=t.touches[0],s=t.touches[1];this.startDistance=this.getFingerDistance(t),this.startScale=this.scale;var e=l(this.wrapper),i=e.left,r=e.top;this.origin={x:Math.abs(o.pageX+s.pageX)/2+i-this.scroll.x,y:Math.abs(o.pageY+s.pageY)/2+r-this.scroll.y},this.scroll.trigger(this.scroll.eventTypes.zoomStart)},c.prototype.zoom=function(t){var o=this.scroll.scroller,s=this.getFingerDistance(t)/this.startDistance*this.startScale;this.scale=this.scaleCure(s);var e=this.scale/this.startScale,i=o.scrollBehaviorX,r=o.scrollBehaviorY,n=this.getNewPos(this.origin.x,e,i),a=this.getNewPos(this.origin.y,e,r);this.resetBoundaries(this.scale,i,"x",n),this.resetBoundaries(this.scale,r,"y",a),o.scrollTo(n,a,0,void 0,{start:{scale:this.lastTransformScale},end:{scale:this.scale}})},c.prototype.getFingerDistance=function(t){var o=t.touches[0],s=t.touches[1];return function(t,o){return Math.sqrt(t*t+o*o)}(Math.abs(o.pageX-s.pageX),Math.abs(o.pageY-s.pageY))},c.prototype.zoomEnd=function(){this._zoomTo(this.scale,this.origin,this.startScale||this.scale),this.zooming=!1,this.scroll.trigger(this.scroll.eventTypes.zoomEnd)},c.prototype.destroy=function(){this.hooksFn.forEach(function(t){var o=t[0],s=t[1],e=t[2];o.off(s,e)}),this.hooksFn.length=0},c.prototype._zoomTo=function(t,o,s){this.scale=this.fixInScaleLimit(t);var e=this.scale/s,i=this.scroll.scroller,r=i.scrollBehaviorX,n=i.scrollBehaviorY;this.resetBoundaries(this.scale,r,"x"),this.resetBoundaries(this.scale,n,"y");var a=this.getNewPos(o.x,e,r,!0),l=this.getNewPos(o.y,e,n,!0);r.currentPos===Math.round(a)&&n.currentPos===Math.round(l)&&this.scale===this.lastTransformScale||i.scrollTo(a,l,this.scroll.options.bounceTime,void 0,{start:{scale:this.lastTransformScale},end:{scale:this.scale}})},c.prototype.resetBoundaries=function(t,o,s,e){var i=this.initScrollBoundary[s][0],r=this.initScrollBoundary[s][1],n=!1;if(1<t){var a="x"===s?"width":"height";r=-this.scaleElementInitSize[a]*(t-1)-this.initScrollBoundary[s][1],n=!0}!function(t){return null==t}(e)&&(r=Math.min(e,r),n=!(!(i=Math.max(e,i))&&!r)),o.minScrollPos=Math.floor(i),o.maxScrollPos=Math.floor(r),o.hasScroll=n},c.prototype.getNewPos=function(t,o,s,e){var i=t-t*o+s.startPos;return e&&(i=function(t,o,s){return t<o?o:s<t?s:t}(i,s.maxScrollPos,0)),Math.floor(i)},c.prototype.scaleCure=function(t){var o=this.zoomOpt,s=o.min,e=void 0===s?1:s,i=o.max,r=void 0===i?4:i;return t<e?t=.5*e*Math.pow(2,t/e):r<t&&(t=2*r*Math.pow(.5,r/t)),t},c.prototype.fixInScaleLimit=function(t){var o=this.zoomOpt,s=o.min,e=void 0===s?1:s,i=o.max,r=void 0===i?4:i;return r<t?t=r:t<e&&(t=e),t},c.prototype.registorHooks=function(t,o,s){t.on(o,s,this),this.hooksFn.push([t,o,s])},c.pluginName="zoom",c});
