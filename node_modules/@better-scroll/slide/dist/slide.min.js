!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Slide=t()}(this,function(){"use strict";var i="undefined"!=typeof window,e=i&&navigator.userAgent.toLowerCase();e&&/wechatdevtools/.test(e),e&&e.indexOf("android");function s(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];for(var s=0;s<t.length;s++){var o=t[s];for(var r in o)e[r]=o[r]}return e}function n(e,t,i){return e<t?t:i<e?i:e}var o=i&&document.createElement("div").style,t=function(){if(!i)return!1;var e={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var t in e)if(void 0!==o[e[t]])return t;return!1}();function r(e){return!1===t?e:"standard"===t?"transitionEnd"===e?"transitionend":e:t+e.charAt(0).toUpperCase()+e.substr(1)}t&&"standard"!==t&&t.toLowerCase();var a=r("transform"),h=r("transition");i&&r("perspective"),r("transitionTimingFunction"),r("transitionDuration"),r("transitionDelay"),r("transformOrigin"),r("transitionEnd");function u(e){if(e instanceof window.SVGElement){var t=e.getBoundingClientRect();return{top:t.top,left:t.left,width:t.width,height:t.height}}return{top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}}function l(e,t){e.removeChild(t)}var g={swipe:{style:"cubic-bezier(0.23, 1, 0.32, 1)",fn:function(e){return 1+--e*e*e*e*e}},swipeBounce:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(e){return e*(2-e)}},bounce:{style:"cubic-bezier(0.165, 0.84, 0.44, 1)",fn:function(e){return 1- --e*e*e*e}}},p=i&&window;function c(){}i&&(p.requestAnimationFrame||p.webkitRequestAnimationFrame||p.mozRequestAnimationFrame||p.oRequestAnimationFrame),i&&(p.cancelAnimationFrame||p.webkitCancelAnimationFrame||p.mozCancelAnimationFrame||p.oCancelAnimationFrame);var d=(f.prototype.init=function(){var e=this.scroll.scroller,t=e.scrollBehaviorX,i=e.scrollBehaviorY,s=u(e.wrapper),o=u(e.content);this.wrapperWidth=s.width,this.wrapperHeight=s.height,this.scrollerHeight=i.hasScroll?o.height:s.height,this.scrollerWidth=t.hasScroll?o.width:s.width;var r=this.slideOpt.stepX||this.wrapperWidth,a=this.slideOpt.stepY||this.wrapperHeight,n=e.content,h=this.slideOpt.el;"string"==typeof h&&(this.slideEl=n.querySelectorAll(h)),this.pages=this.slideEl?this.computePagePosInfoByEl(this.slideEl):this.computePagePosInfo(r,a),this.xLen=this.pages?this.pages.length:0,this.yLen=this.pages&&this.pages[0]?this.pages[0].length:0},f.prototype.hasInfo=function(){return!(!this.pages||!this.pages.length)},f.prototype.getPos=function(e,t){return this.pages[e][t]},f.prototype.getNearestPage=function(e,t){if(this.hasInfo()){for(var i=0,s=0,o=this.pages.length;i<o-1&&!(e>=this.pages[i][0].cx);i++);for(o=this.pages[i].length;s<o-1&&!(t>=this.pages[0][s].cy);s++);return{pageX:i,pageY:s}}},f.prototype.computePagePosInfo=function(e,t){var i,s,o,r,a=[],n=0,h=0,l=this.scroll.scroller.scrollBehaviorX.maxScrollPos,g=this.scroll.scroller.scrollBehaviorY.maxScrollPos;for(s=Math.round(e/2),o=Math.round(t/2);n>-this.scrollerWidth;){for(a[h]=[],i=r=0;i>-this.scrollerHeight;)a[h][r]={x:Math.max(n,l),y:Math.max(i,g),width:e,height:t,cx:n-s,cy:i-o},i-=t,r++;n-=e,h++}return a},f.prototype.computePagePosInfoByEl=function(e){for(var t,i,s,o=[],r=0,a=0,n=0,h=e.length,l=0,g=-1,p=this.scroll.scroller.scrollBehaviorX.maxScrollPos,c=this.scroll.scroller.scrollBehaviorY.maxScrollPos;n<h;n++)s=u(e[n]),(0===n||s.left<=u(e[n-1]).left)&&(l=0,g++),o[l]||(o[l]=[]),r=Math.max(-s.left,p),a=Math.max(-s.top,c),t=r-Math.round(s.width/2),i=a-Math.round(s.height/2),o[l][g]={x:r,y:a,width:s.width,height:s.height,cx:t,cy:i},p<r&&l++;return o},f);function f(e,t){this.scroll=e,this.slideOpt=t,this.slideEl=null,this.init()}var P=(y.prototype.init=function(){this.currentPage={x:0,y:0,pageX:0,pageY:0},this.pagesPos=new d(this.scroll,this.slideOpt),this.checkSlideLoop()},y.prototype.change2safePage=function(e,t){if(this.pagesPos.hasInfo()){e>=this.pagesPos.xLen?e=this.pagesPos.xLen-1:e<0&&(e=0),t>=this.pagesPos.yLen?t=this.pagesPos.yLen-1:t<0&&(t=0);var i=this.pagesPos.getPos(e,t);return{pageX:e,pageY:t,x:i.x,y:i.y}}},y.prototype.getRealPage=function(e){function t(e,t){for(var i=[],s=0;s<t;s++)i.push(s);return i.unshift(t-1),i.push(0),i[e]}var i=s({},e||this.currentPage);return this.loopX&&(i.pageX=t(i.pageX,this.pagesPos.xLen-2)),this.loopY&&(i.pageY=t(i.pageY,this.pagesPos.yLen-2)),{pageX:i.pageX,pageY:i.pageY}},y.prototype.getPageSize=function(){return this.pagesPos.getPos(this.currentPage.pageX,this.currentPage.pageY)},y.prototype.realPage2Page=function(e,t){if(this.pagesPos.hasInfo()){var i=this.pagesPos.xLen-1,s=this.pagesPos.yLen-1,o=0,r=0;return this.loopX&&(e+=1,o+=1,i-=1),this.loopY&&(t+=1,r+=1,s-=1),{realX:e=n(e,o,i),realY:t=n(t,r,s)}}},y.prototype.nextPage=function(){return this.changedPageNum("positive")},y.prototype.prevPage=function(){return this.changedPageNum("negative")},y.prototype.nearestPage=function(e,t,i,s){var o=this.pagesPos.getNearestPage(e,t);if(!o)return{x:0,y:0,pageX:0,pageY:0};var r=o.pageX,a=o.pageY;return r===this.currentPage.pageX&&(r=n(r+=i,0,this.pagesPos.xLen-1)),a===this.currentPage.pageY&&(a+=s,a=n(o.pageY,0,this.pagesPos.yLen-1)),{x:this.pagesPos.getPos(r,0).x,y:this.pagesPos.getPos(0,a).y,pageX:r,pageY:a}},y.prototype.getLoopStage=function(){if(!this.needLoop)return"middle";if(this.loopX){if(0===this.currentPage.pageX)return"head";if(this.currentPage.pageX===this.pagesPos.xLen-1)return"tail"}if(this.loopY){if(0===this.currentPage.pageY)return"head";if(this.currentPage.pageY===this.pagesPos.yLen-1)return"tail"}return"middle"},y.prototype.resetLoopPage=function(){if(this.loopX){if(0===this.currentPage.pageX)return{pageX:this.pagesPos.xLen-2,pageY:this.currentPage.pageY};if(this.currentPage.pageX===this.pagesPos.xLen-1)return{pageX:1,pageY:this.currentPage.pageY}}if(this.loopY){if(0===this.currentPage.pageY)return{pageX:this.currentPage.pageX,pageY:this.pagesPos.yLen-2};if(this.currentPage.pageY===this.pagesPos.yLen-1)return{pageX:this.currentPage.pageX,pageY:1}}},y.prototype.changedPageNum=function(e){var t=this.currentPage.pageX,i=this.currentPage.pageY;return this.slideX&&(t="negative"===e?t-1:t+1),this.slideY&&(i="negative"===e?i-1:i+1),{pageX:t,pageY:i}},y.prototype.checkSlideLoop=function(){this.needLoop=this.slideOpt.loop,1<this.pagesPos.xLen&&(this.slideX=!0),this.pagesPos.pages[0]&&1<this.pagesPos.yLen&&(this.slideY=!0),this.loopX=this.needLoop&&this.slideX,this.loopY=this.needLoop&&this.slideY,this.slideX&&this.slideY&&function(e){console.error("[BScroll warn]: "+e)}("slide does not support two direction at the same time.")},y);function y(e,t){this.scroll=e,this.slideOpt=t}var m=[{key:"next",name:"next"},{key:"prev",name:"prev"},{key:"goToPage",name:"goToPage"},{key:"getCurrentPage",name:"getCurrentPage"}].map(function(e){return{key:e.key,sourceKey:"plugins.slide."+e.name}});function v(e){this.scroll=e,this.resetLooping=!1,this.isTouching=!1,this.scroll.proxy(m),this.scroll.registerType(["slideWillChange"]),this.slideOpt=this.scroll.options.slide,this.page=new P(e,this.slideOpt),this.hooksFn=[],this.init()}return v.prototype.init=function(){var t=this,e=this.slideOpt,i=this.scroll.scroller.content,s=!1;e.loop&&(1<i.children.length?(this.cloneSlideEleForLoop(i),s=!0):e.loop=!1);var o=this.setSlideWidth(i);this.page.currentPage={x:0,y:0,pageX:0,pageY:0},this.willChangeToPage={pageX:0,pageY:0};var r=this.scroll.hooks,a=this.scroll.scroller.hooks;this.registorHooks(r,"refresh",this.initSlideState),this.registorHooks(r,"destroy",this.destroy),this.registorHooks(a,"momentum",this.modifyScrollMetaHandler),this.registorHooks(this.scroll,"scrollEnd",this.amendCurrentPage),this.registorHooks(a,"beforeStart",this.setTouchFlag),this.registorHooks(a,"scroll",this.scrollMoving),this.scroll.eventTypes.mousewheelMove&&this.scroll.eventTypes.mousewheelEnd&&(this.registorHooks(this.scroll,"mousewheelMove",function(){return!0}),this.registorHooks(this.scroll,"mousewheelEnd",function(e){1!==e.directionX&&1!==e.directionY||t.next(),-1!==e.directionX&&-1!==e.directionY||t.prev()})),!1!==e.listenFlick&&this.registorHooks(a,"flick",this.flickHandler),s||o?this.scroll.refresh():this.initSlideState()},v.prototype.next=function(e,t){var i=this.page.nextPage(),s=i.pageX,o=i.pageY;this.goTo(s,o,e,t)},v.prototype.prev=function(e,t){var i=this.page.prevPage(),s=i.pageX,o=i.pageY;this.goTo(s,o,e,t)},v.prototype.goToPage=function(e,t,i,s){var o=this.page.realPage2Page(e,t);o&&this.goTo(o.realX,o.realY,i,s)},v.prototype.getCurrentPage=function(){return this.page.getRealPage()},v.prototype.nearestPage=function(e,t){var i=this.scroll.scroller.scrollBehaviorX,s=this.scroll.scroller.scrollBehaviorY,o=!0;return Math.abs(e-i.absStartPos)<=this.thresholdX&&Math.abs(t-s.absStartPos)<=this.thresholdY&&(o=!1),o?this.page.nearestPage(n(e,i.maxScrollPos,i.minScrollPos),n(t,s.maxScrollPos,s.minScrollPos),i.direction,s.direction):this.page.currentPage},v.prototype.destroy=function(){var e=this.scroll.scroller.content;if(this.slideOpt.loop){var t=e.children;2<t.length&&(l(e,t[t.length-1]),l(e,t[0]))}this.hooksFn.forEach(function(e){var t=e[0],i=e[1],s=e[2];t.eventTypes[i]&&t.off(i,s)}),this.hooksFn.length=0},v.prototype.initSlideState=function(){if(this.page.init(),this.initThreshold(),this.page.slideX||this.page.slideY){var e=this.page.loopX?1:0,t=this.page.loopY?1:0;this.goTo(this.page.currentPage.pageX||e,this.page.currentPage.pageY||t,0)}},v.prototype.initThreshold=function(){var e=this.slideOpt.threshold||.1;if(e%1==0)this.thresholdX=e,this.thresholdY=e;else{var t=this.page.getPageSize();this.thresholdX=Math.round(t.width*e),this.thresholdY=Math.round(t.height*e)}},v.prototype.cloneSlideEleForLoop=function(e){var t=e.children;!function(e,t){var i=t.firstChild;i?function(e,t){t.parentNode.insertBefore(e,t)}(e,i):t.appendChild(e)}(t[t.length-1].cloneNode(!0),e),e.appendChild(t[1].cloneNode(!0))},v.prototype.amendCurrentPage=function(){if(this.isTouching=!1,this.slideOpt.loop)if(this.resetLooping)this.resetLooping=!1;else{var e=!1;if(!this.page.loopX||this.scroll.x!==this.scroll.scroller.scrollBehaviorX.minScrollPos&&this.scroll.x!==this.scroll.scroller.scrollBehaviorX.maxScrollPos||(e=!0),!this.page.loopY||this.scroll.y!==this.scroll.scroller.scrollBehaviorY.minScrollPos&&this.scroll.y!==this.scroll.scroller.scrollBehaviorY.maxScrollPos||(e=!0),e){var t=this.scroll.scroller.scrollBehaviorX,i=this.scroll.scroller.scrollBehaviorY,s=this.page.nearestPage(n(this.scroll.x,t.maxScrollPos,t.minScrollPos),n(this.scroll.y,i.maxScrollPos,i.minScrollPos),0,0),o={x:s.x,y:s.y,pageX:s.pageX,pageY:s.pageY};o.pageX===this.page.currentPage.pageX&&o.pageY===this.page.currentPage.pageY||(this.page.currentPage=o)}var r=this.page.resetLoopPage();if(r)return this.resetLooping=!0,this.goTo(r.pageX,r.pageY,0),!0;this.pageWillChangeTo(this.page.currentPage)}},v.prototype.setSlideWidth=function(e){if(this.slideOpt.disableSetWidth)return!1;if(!this.scroll.options.scrollX)return!1;for(var t=e.children,i=t[0].clientWidth,s=0;s<t.length;s++)t[s].style.width=i+"px";return e.style.width=i*t.length+"px",!0},v.prototype.goTo=function(e,t,i,s){void 0===t&&(t=0);var o=this.page.change2safePage(e,t);if(o){var r=s||this.slideOpt.easing||g.bounce,a=o.x,n=o.y,h=a-this.scroll.scroller.scrollBehaviorX.currentPos,l=n-this.scroll.scroller.scrollBehaviorY.currentPos;(h||l)&&(i=void 0===i?this.getAnimateTime(h,l):i,this.page.currentPage={x:a,y:n,pageX:o.pageX,pageY:o.pageY},this.pageWillChangeTo(this.page.currentPage),this.scroll.scroller.scrollTo(a,n,i,r))}},v.prototype.flickHandler=function(){var e=this.scroll.scroller.scrollBehaviorX,t=this.scroll.scroller.scrollBehaviorY,i=e.currentPos-e.startPos,s=t.currentPos-t.startPos,o=this.getAnimateTime(i,s);this.goTo(this.page.currentPage.pageX+e.direction,this.page.currentPage.pageY+t.direction,o)},v.prototype.getAnimateTime=function(e,t){return this.slideOpt.speed?this.slideOpt.speed:Math.max(Math.max(Math.min(Math.abs(e),1e3),Math.min(Math.abs(t),1e3)),300)},v.prototype.modifyScrollMetaHandler=function(e){var t=this.nearestPage(e.newX,e.newY);e.time=this.getAnimateTime(e.newX-t.x,e.newY-t.y),e.newX=t.x,e.newY=t.y,e.easing=this.slideOpt.easing||g.bounce,this.page.currentPage={x:e.newX,y:e.newY,pageX:t.pageX,pageY:t.pageY},this.pageWillChangeTo(this.page.currentPage)},v.prototype.scrollMoving=function(e){if(this.isTouching){var t=this.nearestPage(e.x,e.y);this.pageWillChangeTo(t)}},v.prototype.pageWillChangeTo=function(e){var t=this.page.getRealPage(e);t.pageX===this.willChangeToPage.pageX&&t.pageY===this.willChangeToPage.pageY||(this.willChangeToPage=t,this.scroll.trigger("slideWillChange",this.willChangeToPage))},v.prototype.setTouchFlag=function(){this.isTouching=!0},v.prototype.registorHooks=function(e,t,i){e.on(t,i,this),this.hooksFn.push([e,t,i])},v.pluginName="slide",v});
