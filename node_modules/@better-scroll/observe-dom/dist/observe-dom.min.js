!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ObserveDom=e()}(this,function(){"use strict";var o="undefined"!=typeof window,t=o&&navigator.userAgent.toLowerCase(),r=(t&&/wechatdevtools/.test(t),t&&t.indexOf("android"),o&&document.createElement("div").style),e=function(){if(!o)return!1;var t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(var e in t)if(void 0!==r[t[e]])return e;return!1}();function n(t){return!1===e?t:"standard"===e?"transitionEnd"===t?"transitionend":t:e+t.charAt(0).toUpperCase()+t.substr(1)}e&&"standard"!==e&&e.toLowerCase();var i=n("transform"),s=n("transition");o&&n("perspective"),n("transitionTimingFunction"),n("transitionDuration"),n("transitionDelay"),n("transformOrigin"),n("transitionEnd");function c(t){if(t instanceof window.SVGElement){var e=t.getBoundingClientRect();return{top:e.top,left:e.left,width:e.width,height:e.height}}return{top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight}}var a=o&&window;function h(){}o&&(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame),o&&(a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.mozCancelAnimationFrame||a.oCancelAnimationFrame);function f(t){var e=this;this.scroll=t,this.stopObserver=!1,this.hooksFn=[],this.init(),this.registorHooks(this.scroll.hooks,"enable",function(){e.stopObserver&&e.init()}),this.registorHooks(this.scroll.hooks,"disable",function(){e.stopObserve()}),this.registorHooks(this.scroll.hooks,"destroy",function(){e.destroy()})}return f.prototype.init=function(){var e=this;"undefined"!=typeof MutationObserver?(this.observer=new MutationObserver(function(t){e.mutationObserverHandler(t,0)}),this.startObserve(this.observer)):this.checkDOMUpdate()},f.prototype.destroy=function(){this.stopObserve(),this.hooksFn.forEach(function(t){var e=t[0],o=t[1],r=t[2];e.off(o,r)}),this.hooksFn.length=0},f.prototype.mutationObserverHandler=function(t,e){var o=this;if(!this.shouldNotRefresh()){for(var r=!1,n=!1,i=0;i<t.length;i++){var s=t[i];if("attributes"!==s.type){r=!0;break}if(s.target!==this.scroll.scroller.content){n=!0;break}}r?this.scroll.refresh():n&&(clearTimeout(e),e=window.setTimeout(function(){o.shouldNotRefresh()||o.scroll.refresh()},60))}},f.prototype.startObserve=function(t){t.observe(this.scroll.scroller.content,{attributes:!0,childList:!0,subtree:!0})},f.prototype.shouldNotRefresh=function(){var t=this.scroll.scroller,e=t.scrollBehaviorX,o=t.scrollBehaviorY,r=e.currentPos>e.minScrollPos||e.currentPos<e.maxScrollPos||o.currentPos>o.minScrollPos||o.currentPos<o.maxScrollPos;return t.animater.pending||r},f.prototype.checkDOMUpdate=function(){var o=this,r=this.scroll,n=r.scroller.content,i=c(n),s=i.width,a=i.height;function h(){setTimeout(function(){!function(){if(!o.stopObserver){var t=(i=c(n)).width,e=i.height;s===t&&a===e||r.refresh(),s=t,a=e,h()}}()},1e3)}h()},f.prototype.registorHooks=function(t,e,o){t.on(e,o,this),this.hooksFn.push([t,e,o])},f.prototype.stopObserve=function(){this.stopObserver=!0,this.observer&&this.observer.disconnect()},f.pluginName="observeDOM",f});
